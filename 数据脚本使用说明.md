# 数据脚本使用说明

## 功能说明

`insert_sample_data.py` 脚本用于向旅游平台数据库插入真实的示例数据，包括景点、美食、酒店、攻略、公告等数据。

## 数据内容

脚本会插入以下数据：

- **景点数据**：15条太原市真实景点数据
- **美食数据**：15条山西传统美食数据
- **酒店数据**：10条酒店数据，每个酒店包含2-3个房间
- **攻略数据**：10条旅游攻略数据
- **公告数据**：5条活动公告数据

## 环境要求

- Python 3.6+
- MySQL 5.7+ 或 MySQL 8.0+
- 已创建 `tourism_platform` 数据库
- 数据库表结构已初始化

## 安装依赖

```bash
pip install -r requirements.txt
```

或者直接安装：

```bash
pip install pymysql
```

## 配置数据库连接

编辑 `insert_sample_data.py` 文件，修改数据库配置：

```python
DB_CONFIG = {
    'host': 'localhost',      # 数据库主机
    'port': 3306,             # 数据库端口
    'user': 'root',           # 数据库用户名
    'password': '123456',     # 数据库密码
    'database': 'tourism_platform',  # 数据库名
    'charset': 'utf8mb4'
}
```

## 使用方法

### 1. 确保数据库已创建

确保 `tourism_platform` 数据库已创建，并且表结构已初始化。

### 2. 运行脚本

```bash
python insert_sample_data.py
```

### 3. 查看结果

脚本会输出插入的数据统计信息：

```
============================================================
旅游平台示例数据插入脚本
============================================================
✓ 数据库连接成功

开始插入数据...

✓ 成功插入 15 条景点数据
✓ 成功插入 15 条美食数据
✓ 成功插入 10 条酒店数据（包含房间）
✓ 成功插入 10 条攻略数据
✓ 成功插入 5 条公告数据

============================================================
✓ 数据插入完成！共插入 55 条主要数据
============================================================
```

## 数据说明

### 景点数据
- 包含太原市真实景点，如晋祠、双塔寺、蒙山大佛等
- 包含真实的地理坐标（经纬度）
- 包含门票价格、开放时间、评分等信息

### 美食数据
- 包含山西传统美食，如刀削面、过油肉、老陈醋等
- 包含食材、制作方法、起源等信息
- 部分美食包含推荐餐厅信息（JSON格式）

### 酒店数据
- 包含不同星级的酒店（2-5星）
- 每个酒店包含2-3个房间类型
- 房间价格根据酒店星级自动调整
- 包含真实的地理坐标（经纬度）

### 攻略数据
- 包含1日游、2日游、主题游等不同类型
- 包含预算、最佳季节、注意事项等信息

### 公告数据
- 包含节庆活动、优惠活动、新闻资讯等类型
- 包含开始和结束时间

## 注意事项

1. **分类数据**：脚本会自动查询现有的分类数据，如果分类表为空，category_id 将为 NULL
2. **图片路径**：脚本插入的图片路径为示例路径，实际使用时需要上传真实图片
3. **重复运行**：可以多次运行脚本，但会产生重复数据
4. **数据清理**：如需清理数据，请手动删除或使用SQL语句

## 清理数据（可选）

如果需要清理插入的测试数据，可以使用以下SQL：

```sql
-- 清理景点数据（保留前N条）
DELETE FROM attraction WHERE id > (SELECT MIN(id) FROM (SELECT id FROM attraction ORDER BY id DESC LIMIT 1 OFFSET 15) AS t);

-- 清理美食数据
DELETE FROM food WHERE id > (SELECT MIN(id) FROM (SELECT id FROM food ORDER BY id DESC LIMIT 1 OFFSET 15) AS t);

-- 清理酒店数据（会级联删除房间）
DELETE FROM hotel WHERE id > (SELECT MIN(id) FROM (SELECT id FROM hotel ORDER BY id DESC LIMIT 1 OFFSET 10) AS t);

-- 清理攻略数据
DELETE FROM strategy WHERE id > (SELECT MIN(id) FROM (SELECT id FROM strategy ORDER BY id DESC LIMIT 1 OFFSET 10) AS t);

-- 清理公告数据
DELETE FROM announcement WHERE id > (SELECT MIN(id) FROM (SELECT id FROM announcement ORDER BY id DESC LIMIT 1 OFFSET 5) AS t);
```

## 数据补充指南

### 地图数据补充

如果景点或酒店数据缺少经纬度坐标，可以使用以下方法补充：

#### 方法1：使用高德地图API（推荐，批量处理）

**地理编码API：**
通过地址获取经纬度坐标

**API地址：**
```
https://restapi.amap.com/v3/geocode/geo?key=YOUR_KEY&address=地址
```

**示例：**
```bash
# 查询"太原市府西街"的坐标
curl "https://restapi.amap.com/v3/geocode/geo?key=YOUR_KEY&address=太原市府西街"
```

**响应示例：**
```json
{
  "status": "1",
  "geocodes": [{
    "location": "112.548248,37.870014"
  }]
}
```

#### 方法2：手动查询（少量数据）

1. 访问高德地图坐标拾取工具：https://lbs.amap.com/tools/picker
2. 在地图上找到位置
3. 复制经纬度坐标
4. 更新数据库

#### 方法3：使用SQL脚本批量更新

**更新景点坐标示例：**
```sql
UPDATE `attraction` 
SET `longitude` = 112.549248, 
    `latitude` = 37.857014
WHERE `id` = 2 AND `name` = '双塔博物馆';
```

**更新酒店坐标示例：**
```sql
UPDATE `hotel` 
SET `longitude` = 112.548248, 
    `latitude` = 37.870014
WHERE `id` = 2 AND `name` = '山西国贸大饭店';
```

**更新美食推荐餐厅示例：**
```sql
UPDATE `food` 
SET `recommended_restaurants` = '[
  {
    "name": "餐厅名称",
    "longitude": 112.549248,
    "latitude": 37.857014,
    "address": "餐厅地址",
    "image": "图片URL"
  }
]'
WHERE `id` = 1;
```

**注意：** `recommended_restaurants` 字段是 JSON 格式，需要确保格式正确。

### 数据验证

补充数据后，执行以下SQL验证：

```sql
-- 检查景点数据完整性
SELECT 
    COUNT(*) as total,
    COUNT(longitude) as has_longitude,
    COUNT(latitude) as has_latitude,
    COUNT(CASE WHEN longitude IS NOT NULL AND latitude IS NOT NULL THEN 1 END) as complete
FROM attraction 
WHERE status = 1;

-- 检查酒店数据完整性
SELECT 
    COUNT(*) as total,
    COUNT(longitude) as has_longitude,
    COUNT(latitude) as has_latitude,
    COUNT(CASE WHEN longitude IS NOT NULL AND latitude IS NOT NULL THEN 1 END) as complete
FROM hotel 
WHERE status = 1;

-- 检查美食推荐餐厅数据
SELECT 
    COUNT(*) as total,
    COUNT(recommended_restaurants) as has_restaurants
FROM food 
WHERE status = 1;
```

### 太原市常用坐标参考

- **太原市中心**：经度 112.549248，纬度 37.857014
- **迎泽区**：经度 112.549248，纬度 37.857014
- **府西街**：经度 112.548248，纬度 37.870014
- **双塔寺**：经度 112.549248，纬度 37.857014

## 常见问题

### Q1: 连接数据库失败
**A**: 检查数据库配置是否正确，确保数据库服务已启动，用户名密码正确。

### Q2: 插入数据时出现外键约束错误
**A**: 确保分类表（attraction_category、food_category）中已有数据，或者修改脚本将 category_id 设置为 NULL。

### Q3: 字符编码问题
**A**: 确保数据库使用 utf8mb4 字符集，脚本已设置 charset='utf8mb4'。

### Q4: 图片路径不存在
**A**: 图片路径为示例路径，实际使用时需要：
1. 上传真实图片到 `/uploads/images/` 目录
2. 或者修改脚本中的图片路径为实际路径

### Q5: 如何批量补充经纬度数据？
**A**: 
1. 使用高德地图API批量获取坐标
2. 编写脚本批量更新数据库
3. 或者使用SQL脚本手动更新

## 扩展说明

如果需要插入更多数据或修改数据内容：

1. **修改数据量**：修改各个数据列表的长度
2. **添加新数据**：在对应的数据列表中添加新项
3. **修改字段**：根据实际需求修改插入的字段值

## 技术支持

如有问题，请检查：
1. Python版本是否符合要求
2. pymysql是否已正确安装
3. 数据库连接配置是否正确
4. 数据库表结构是否完整

## 相关文档

- [开发指南.md](./开发指南.md) - 数据库设计说明
- [配置指南.md](./配置指南.md) - 高德地图API配置
